"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[609],{609:(e,t,s)=>{s.r(t),s.d(t,{createWidget:()=>C});var n=s(378),i=s(42);const a={grid:"_t",column:"_u",spacer:"_v",cell:"_w",enabled:"_x"};function c({note:e}){const[t,s]=n.useState(e.enabled);return n.useEffect((()=>e.onChanges(s)),[e]),n.createElement("div",{onClick:e.toggle,className:i(a.cell,t&&a.enabled)})}function r({step:e}){const[t,s]=n.useState(e.notes);return n.useEffect((()=>e.subscribe(s)),[e]),n.createElement("div",{className:a.column},t.map((e=>n.createElement(c,{key:e.pitch.name,note:e}))))}const o=64,h=20;function l({view:e}){const[t,s]=n.useState(e.state);n.useEffect((()=>e.subscribe(s)),[e]);const i=n.useCallback((({scrollLeft:t,clientWidth:s})=>{const n=Math.floor(t/h-o),i=Math.ceil((t+s)/h+o);e.setRange(n,i)}),[e]),c=n.useCallback((e=>{i(e.currentTarget)}),[i]),l=function(e){const t=n.useRef(e),[s]=n.useState((()=>new ResizeObserver((e=>{var s;return t.current(null===(s=e[0])||void 0===s?void 0:s.target)}))));return n.useEffect((()=>{t.current=e}),[e]),n.useCallback((e=>{null==e?s.disconnect():s.observe(e)}),[s])}(i);return console.log(t.steps.length,t.before,t.after),n.createElement("div",{className:a.grid,style:{"--cell-size":`${h}px`},onScroll:c,ref:l},n.createElement("div",{className:a.spacer,style:{width:t.before*h+"px"}}),t.steps.map((e=>n.createElement(r,{key:e.index,step:e}))),n.createElement("div",{className:a.spacer,style:{width:t.after*h+"px"}}))}function u({project:e}){const[t]=n.useState((()=>e.sequence.createView(void 0,void 0)));return n.createElement("div",null,n.createElement(l,{view:t}))}var p=s(401);function d(e,t){return e.length===t.length&&e.every(((e,s)=>t[s]===e))}const b={C:0,D:2,E:4,F:5,G:7,A:9,B:11},g={bb:-2,b:-1,"":0,"#":1,x:2};class m{constructor(e){this.name=e;const t=e.match(/([A-G])(b{0,2}|#|x)(-?\d+)/);if(null==t)throw new Error(`Invalid pitch notation: ${e}`);const s=t[1],n=t[2],i=parseInt(t[3]);this.midiNumber=12+12*i+b[s]+g[n]}}class v{constructor(e,t){this.step=e,this.pitch=t,this.state=new p.Xe(!1),this.toggle=()=>{this.state.next(!this.state.value)}}get enabled(){return this.state.value}onChanges(e){return this.state.subscribe(e)}}class f{constructor(e,t){this.index=e,this.pitches=t,this.noteMap=new WeakMap,this.createNotes=e=>e.map((e=>{const t=this.noteMap.get(e);if(null!=t)return t;const s=new v(this,e);this.noteMap.set(e,s);const n=s.onChanges((()=>{this.activation.next(this),n()}));return s})),this.activation=new p.xQ}get notes(){return this.createNotes(this.pitches.value)}subscribe(e){return this.pitches.pipe((0,p.UI)(this.createNotes)).subscribe(e)}onActivation(e){return this.activation.subscribe(e)}}class w{constructor(e,t,s){this.steps=e,this.normaliseRange=([e,t])=>{const s=this.steps.value.length;e=null!=e?e:0;const n=(t=Math.max(null!=t?t:s,e))-e;return[Math.max(0,Math.min(s-n,e)),Math.max(n,Math.min(s,t))]},this.createState=([e,t]=this.window.value,s=this.steps.value)=>({before:e,after:s.length-t,steps:s.slice(e,t)}),this.window=new p.Xe(this.normaliseRange([t,s]))}setRange(e,t){this.window.next(this.normaliseRange([e,t]))}get state(){return this.createState()}subscribe(e){return(0,p.TS)(this.window.pipe((0,p.xb)(d)),this.steps,this.createState).subscribe(e)}}class x{constructor(e,t){this.padding=t,this.sentinels=[],this.autoExtend=e=>{const t=this.steps.value.length-e.index;t<this.padding&&this.extend(this.padding-t)},this.pitches=new p.Xe(e.map((e=>new m(e)))),this.steps=new p.Xe([]),this.extend(t)}extend(e){if(0===e)return;const t=this.steps.value;for(let s=0;s<e;s++){const e=new f(t.length,this.pitches);this.sentinels.push(e.onActivation(this.autoExtend)),this.sentinels.length>this.padding&&this.sentinels.shift()(),t.push(e)}this.steps.next(t)}createView(e,t){return new w(this.steps,e,t)}}class E{constructor(){this.notes=["F2","G2","C3","D3","E3","F3","G3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","G5","A5"],this.sequence=new x(this.notes,256)}}function C(){const e=new E;return n.createElement(u,{project:e})}}}]);